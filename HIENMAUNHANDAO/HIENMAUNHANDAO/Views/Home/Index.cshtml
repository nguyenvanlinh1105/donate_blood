@model HIENMAUNHANDAO.ViewModel.HomeViewModel
@{
    Layout = "Layout_Home";
}
<link rel="stylesheet" href="~/lib/flatpickr/all.min.flatpickr.css">
<style>
    .search-bar-container {
    display: flex;
    align-items: center;
    background-color: #fff;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 50px 30px 50px 30px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    font-family: Arial, sans-serif;
    max-width: 100%;
    position: absolute;
    top: 90%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000; 
    background: #fff; 
    }

    /* Label styling */
    .search-bar-container label {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    margin-right: 10px;
    display: flex;
    align-items: center;
    }

    /* Calendar icon inside label */
    .search-bar-container label svg {
    width: 20px;
    height: 20px;
    margin-right: 5px;
    fill: #666;
    }

    /* Date range input styling */
    .date-range {
    display: flex;
    align-items: center;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 5px 10px;
    margin-right: 10px;
    font-size: 14px;
    color: #666;
    position: relative;
    }

    .date-range input {
    border: none;
    outline: none;
    width: 100px;
    font-size: 14px;
    color: #666;
    background: transparent;
    text-align: center;
    }

    .date-range input::placeholder {
    color: #999;
    }

    .date-range svg {
    width: 16px;
    height: 16px;
    margin-left: 5px;
    fill: #666;
    cursor: pointer;
    }

    /* Search button styling */
    .search-button {
    background-color: #0052cc;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 8px 15px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s;
    }

    .search-button:hover {
    background-color: #003d99;
    }


</style>
<link href="~/css/home/home.css" rel="stylesheet" />

<partial name="_AlertMessageSuccess" />
<partial name="_AlertMessageError" />

<!-- Slider (Outside main) -->
<div class="slider-container">
    <div class="slider">
        <div class="slide active" style="background-image: url('img/logo/anhiu.png');">
            <div class="slide-content" style="left:30%; top: 45%;">
                <h1>Hiến Máu Cứu Người - Nghĩa Cử Cao Đẹp</h1>
                <p>Một giọt máu cho đi - Một cuộc đời ở lại </p>
                <a href="#" class="cta-button">Đăng Ký Hiến Máu Ngay</a>
            </div>
        </div>
        <div class="slide " style="background-image: url('img/logo/anhiu.png');">
            <div class="slide-content" style="left:30%; top: 45%;">
                <h1>Mỗi Lần Hiến Máu Là Một Lần Cứu Người</h1>
                <p>Góp sức nhỏ bé của bạn để tạo nên sự khác biệt lớn lao</p>
                <a href="#" class="cta-button">Tìm Hiểu Thêm</a>
            </div>
        </div>
        <div class="slide" style="background-image: url('img/logo/anhiu.png');">
            <div class="slide-content" style="left:30%; top: 45%;">
                <h1>Ngân Hàng Máu Đà Nẵng</h1>
                <p>Nguồn cung cấp máu ổn định cho các bệnh viện trên toàn thành phố</p>
                <a href="#" class="cta-button">Xem Địa Điểm Hiến Máu</a>
            </div>
        </div>
    </div>
    <div class="slider-nav">
        <div class="slider-dot active"></div>
        <div class="slider-dot"></div>
        <div class="slider-dot"></div>
    </div>
    <div class="slider-arrow prev"><i class="fas fa-chevron-left"></i></div>
    <div class="slider-arrow next"><i class="fas fa-chevron-right"></i></div>
</div>
<main>
    @* // Searchbox *@
    <form id="paginationForm" asp-action="Index" asp-controller="Home" method="post">
        <div class="search-bar-container">
            <label>
                <i class="fa-solid fa-calendar-days" style="padding: 5px;"></i>
                Bạn cần đặt lịch vào thời gian nào?
            </label>
            <div class="date-range">
                <input type="text" id="fromDate" value="@(Model.modelHome.fromDate?.ToString("dd/MM/yyyy"))" name="fromDate" placeholder="Từ ngày" readonly>
                <span>-</span>
                <input type="text" id="toDate" value="@(Model.modelHome.toDate?.ToString("dd/MM/yyyy"))" name="toDate" placeholder="Đến ngày" readonly>
                <svg id="calendarIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M20 3H19V1H17V3H7V1H5V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H20C21.1 21 22 20.1 22 19V5C22 3.9 21.1 3 20 3ZM20 19H4V8H20V19ZM20 6H4V5H20V6ZM7 11H5V9H7V11ZM11 11H9V9H11V11ZM15 11H13V9H15V11ZM19 11H17V9H19V11ZM7 15H5V13H7V15ZM11 15H9V13H11V15ZM15 15H13V13H15V15ZM19 15H17V13H19V15ZM7 19H5V17H7V19ZM11 19H9V17H11V19Z" />
                </svg>
            </div>
            <button class="search-button">Tìm kiếm</button>
        </div>

        <!-- Events Section -->
        <section class="section events-section">
            <div class="section-title">
                <h2>Sự Kiện Hiến Máu</h2>
                @if (@ViewBag.Count == null)
                {
                    <p style="font-size:1.4rem;">Các chương trình hiến máu sắp diễn ra tại thành phố Đà Nẵng</p>
                }
                else
                {
                    <p style="font-size:1.4rem;"> <strong>@ViewBag.Count</strong> chương trình hiến máu được tìm thấy !</p>
                }
            </div>
            <div class="events-grid">
                @{
                    // Hàm rút ngắn chuỗi
                    string Truncate(string text, int maxLength)
                    {
                        if (string.IsNullOrEmpty(text)) return text;
                        return text.Length <= maxLength ? text : text.Substring(0, maxLength) + "...";
                    }
                }
                @foreach(var item in Model.suKienHienMau)
                {
                    <div class="event-card">
                        <div class="event-image" style="background-image: url(img/cstn/@item.AnhDaiDien);"></div>
                        <div class="event-details">
                        <span class="event-date">Thời gian từ @item.TgBatDauSk?.ToString("dd/MM/yyyy HH:mm") đến @item.TgKetThucSk?.ToString("dd/MM/yyyy HH:mm")</span>
                        <h3>@Truncate(item.TieuDe, 65)</h3>
                        <p><p>@Truncate(item.NoiDung, 130)</p></p>
                        <p><strong>Số lượng đơn vị máu cần hiến:@item.SoLuongDK</strong></p>
                        <p>Số lượng đăng kí:<strong>@item.soLuongDDK/@item.SoLuongDK</strong></p>
                        <p>Thời gian đăng kí trước ngày: <strong>@item.TgBatDauSk?.AddDays(-1).ToString("dd/MM/yyyy")</strong></p>
                        <span class="event-location"><i class="fas fa-map-marker-alt"></i>  Địa chỉ:<strong> @item.TenCoSoTinhNguyen</strong></span>

                            <div class="event-meta">
                            @if (@Model.listSKDKbyIdNguoiDung != null && @Model.listSKDKbyIdNguoiDung.Contains(item.idSuKien))
                                {
                                    <span style="color: #4e4c4c;background: #ffd7a7;" class="event-button registered"><i class="fas fa-check"></i> Đã đăng ký</span>
                                }
                                else
                                {
                                <a asp-controller="Home" asp-action="DangKiHienMau" asp-route-IdSuKien="@item.idSuKien " class="event-button">
                                        <i class="fas fa-hand-holding-heart"></i> Đăng ký hiến máu
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                    
                }           

            </div>

            <div class="pagination" id="pagination" data-totalpage="@Model.paging.TotalPage" data-pageactive="@Model.paging.PageActive">
                <!-- Các trang sẽ được render bởi JavaScript -->
                <input type="hidden" name="pageActive" id="pageActive" value="@Model.paging.PageActive">
            </div>

        </section>
    </form>
    <!-- Commitment Section -->
    <section class="section commitment-section">
        <div class="section-title">
            <h2>Vì Sao Nên Hiến Máu?</h2>
            <p>Hiến máu không chỉ cứu sống người khác mà còn mang lại nhiều lợi ích cho sức khỏe của chính bạn</p>
        </div>
        <div class="commitment-grid">
            <div class="commitment-card">
                <div class="commitment-icon"><i class="fas fa-heartbeat"></i></div>
                <h3>Cải Thiện Sức Khỏe</h3>
                <p>Hiến máu giúp kích thích sản sinh tế bào máu mới, cải thiện lưu thông máu và giảm nguy cơ mắc bệnh tim mạch</p>
            </div>
            <div class="commitment-card">
                <div class="commitment-icon"><i class="fas fa-user-md"></i></div>
                <h3>Kiểm Tra Sức Khỏe</h3>
                <p>Mỗi lần hiến máu, bạn được kiểm tra các chỉ số sức khỏe cơ bản và xét nghiệm các bệnh truyền nhiễm miễn phí</p>
            </div>
            <div class="commitment-card">
                <div class="commitment-icon"><i class="fas fa-hands-helping"></i></div>
                <h3>Giúp Đỡ Cộng Đồng</h3>
                <p>Mỗi đơn vị máu của bạn có thể cứu sống 3 người. Hãy cùng chúng tôi xây dựng cộng đồng nhân ái</p>
            </div>
        </div>
    </section>

    <!-- Benefits Section -->
    <!-- Stats Section -->
    <section class="section stats-section">
        <div class="section-title">
            <h2>Chúng Tôi Đã Đạt Được</h2>
            <p>Những con số ấn tượng thể hiện sự đóng góp của cộng đồng</p>
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number" data-count="125000">0</div>
                <div class="stat-label">Lượt Hiến Máu</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" data-count="375000">0</div>
                <div class="stat-label">Người Được Cứu</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" data-count="85">0</div>
                <div class="stat-label">Địa Điểm Hiến Máu</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" data-count="25000">0</div>
                <div class="stat-label">Tình Nguyện Viên</div>
            </div>
        </div>
    </section>

    <!-- Process Section -->
    <section class="section process-section">
        <div class="section-title">
            <h2>Quy Trình Hiến Máu</h2>
            <p>Hiến máu là quá trình đơn giản, an toàn và chỉ mất khoảng 30 phút</p>
        </div>
        <div class="process-steps">
            <div class="process-step">
                <div class="step-number">1</div>
                <h3>Đăng Ký</h3>
                <p>Điền thông tin cá nhân và khai báo tình trạng sức khỏe</p>
            </div>
            <div class="process-step">
                <div class="step-number">2</div>
                <h3>Khám Sàng Lọc</h3>
                <p>Kiểm tra huyết áp, nhịp tim và xét nghiệm nhanh</p>
            </div>
            <div class="process-step">
                <div class="step-number">3</div>
                <h3>Hiến Máu</h3>
                <p>Quá trình hiến máu chỉ mất khoảng 5-10 phút</p>
            </div>
            <div class="process-step">
                <div class="step-number">4</div>
                <h3>Nghỉ Ngơi</h3>
                <p>Nghỉ ngơi 10-15 phút và nhận quà tặng từ chương trình</p>
            </div>
        </div>
    </section>


    <!-- Testimonials Section -->
    <section class="section testimonials-section">
        <div class="section-title">
            <h2>Cảm Nhận Của Người Hiến Máu</h2>
            <p>Những chia sẻ chân thành từ những người đã tham gia hiến máu</p>
        </div>
        <div class="testimonials-container">
            <div class="testimonial">
                <div class="testimonial-text">
                    Tôi đã hiến máu 10 lần trong 5 năm qua và cảm thấy vô cùng hạnh phúc khi biết rằng máu của mình có thể giúp đỡ được nhiều người. Hiến máu không chỉ là nghĩa cử cao đẹp mà còn giúp tôi kiểm tra sức khỏe định kỳ.
                </div>
                <div class="testimonial-author">
                    <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Nguyễn Văn A" class="author-avatar">
                    <div class="author-name">Nguyễn Văn Thắng</div>
                    <div class="author-title">Nhân viên văn phòng, 28 tuổi</div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="section cta-section">
        <h2>Bạn Sẵn Sàng Cứu Người?</h2>
        <p>Đăng ký ngay hôm nay để trở thành người hiến máu tình nguyện và góp phần cứu sống nhiều bệnh nhân</p>
        <div class="cta-buttons">
            <a href="#" class="cta-button">Đăng Ký Hiến Máu</a>
            <a href="#" class="cta-button-outline">Tìm Hiểu Thêm</a>
        </div>
    </section>
</main>
<script src="~/js/flatpickr.js" defer></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('paginationForm');
        const pageInput = document.getElementById('pageActive');
        const pagination = document.getElementById('pagination');

        const totalPage = parseInt(pagination.getAttribute('data-totalpage'));
        let pageActive = parseInt(pageInput.value) || 1;

        // Biến trạng thái để biết có đang ở "trạng thái mở rộng trang 3" hay không
        let isExpandedAt3 = false;

        // Hàm render phân trang theo trạng thái
        function renderPagination() {
            pagination.innerHTML = ''; // Xóa trước khi render lại
            pagination.appendChild(pageInput); // Cho input hidden vào lại

            if (totalPage <= 10) {
                // Nếu <= 10 trang thì hiển thị hết
                for (let i = 1; i <= totalPage; i++) {
                    const a = document.createElement('a');
                    a.href = '#';
                    a.textContent = i;
                    if (i === pageActive) a.classList.add('active');
                    pagination.insertBefore(a, pageInput);
                }
            } else {
                // Nếu > 10 trang thì hiển thị theo yêu cầu

                // Tạo 2 phần trạng thái: collapsed (mặc định) và expandedAt3

                if (!isExpandedAt3) {
                    // Mặc định: 1 2 3 ... ... last
                    addPageLink(1);
                    addPageLink(2);
                    addPageLink(3);
                    addEllipsis();
                    addEllipsis();
                    addPageLink(totalPage);
                } else {
                    // Expanded ở trang 3: 2 3 4 ... ... last
                    addPageLink(2);
                    addPageLink(3);
                    addPageLink(4);
                    addEllipsis();
                    addEllipsis();
                    addPageLink(totalPage);
                }

                // Đánh dấu active
                markActive();
            }
        }

        // Hàm thêm trang
        function addPageLink(page) {
            const a = document.createElement('a');
            a.href = '#';
            a.textContent = page;
            pagination.insertBefore(a, pageInput);
        }

        // Hàm thêm dấu ...
        function addEllipsis() {
            const span = document.createElement('span');
            span.textContent = '...';
            span.classList.add('ellipsis');
            pagination.insertBefore(span, pageInput);
        }

        // Đánh dấu trang đang active
        function markActive() {
            const links = pagination.querySelectorAll('a');
            links.forEach(link => {
                const p = parseInt(link.textContent);
                if (p === pageActive) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        // Xử lý click trên pagination
        pagination.addEventListener('click', function (event) {
            if (event.target && event.target.matches('a')) {
                event.preventDefault();
                const clickedPage = parseInt(event.target.textContent);

                if (totalPage > 10) {
                    // Xử lý toggle trạng thái khi click vào 3
                    if (clickedPage === 3) {
                        isExpandedAt3 = !isExpandedAt3;
                    } else {
                        // Nếu click trang khác thì reset trạng thái mở rộng
                        isExpandedAt3 = false;
                    }
                }

                pageActive = clickedPage;
                pageInput.value = pageActive;
                renderPagination();

                // Submit form để tải lại trang với page mới
                form.submit();
            }
        });

        // Khi form submit, nếu pageActive rỗng thì mặc định = 1
        form.addEventListener('submit', function () {
            if (!pageInput.value || pageInput.value === '') {
                pageInput.value = 1;
            }
        });

        // Render phân trang ban đầu
        renderPagination();
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Khởi tạo Flatpickr với chế độ range
        const fp = flatpickr("#fromDate", {
            mode: "range",
            dateFormat: "d/m/Y",
            onChange: function (selectedDates, dateStr, instance) {
                if (selectedDates.length === 2) {
                    const fromDate = selectedDates[0];
                    const toDate = selectedDates[1];
                    document.getElementById("fromDate").value = instance.formatDate(fromDate, "d/m/Y");
                    document.getElementById("toDate").value = instance.formatDate(toDate, "d/m/Y");
                }
            },
            clickOpens: false // Ngăn mở lịch khi nhấp vào input
        });

        // Gắn sự kiện click cho biểu tượng lịch
        document.getElementById("calendarIcon").addEventListener("click", function () {
            fp.open(); // Mở lịch Flatpickr
        });
    });
</script>